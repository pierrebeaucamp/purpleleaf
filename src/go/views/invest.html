{{define "body"}}
{{template "header" .login}}

<script type="text/javascript">
    var PAYMILL_PUBLIC_KEY = '098404831422120f140ad1f1a4558561';
</script>

<h3>Invest in {{.project.Name}}</h3>

<form id="payment-form" action="/paymill" method="POST">

  <input class="card-amount-int" type="hidden" value="15" />
  <input class="card-currency" type="hidden" value="EUR" />

  <div class="form-row">
    <label>Card number</label>
    <input class="card-number" type="text" size="20" />
  </div>

  <div class="form-row">
    <label>CVC</label>
    <input class="card-cvc" type="text" size="4" />
  </div>

  <div class="form-row">
    <label>Name</label>
    <input class="card-holdername" type="text" size="4" />
  </div>

  <div class="form-row">
    <label>Expiry date (MM/YYYY)</label>
    <input class="card-expiry-month" type="text" size="2" />
    <span></span>
    <input class="card-expiry-year" type="text" size="4" />
  </div>


  <button class="submit-button" type="submit">Submit</button>

</form>

    
<script src="https://bridge.paymill.com/"></script>

<script language="javascript" type="text/javascript">
$(document).ready(function() {
  function PaymillResponseHandler(error, result) {
    if (error) {
      // Displays the error above the form
      $(".payment-errors").text(error.apierror);
    } else {
      $(".payment-errors").text("");
      var form = $("#payment-form");
      // Token
      var token = result.token;

      // Insert token into form in order to submit to server
      form.append("<input type='hidden' name='paymillToken' value='" + token + "'/>");
      form.get(0).submit();
    }
    $(".submit-button").removeAttr("disabled");
  }
  
  $("#payment-form").submit(function(event) {
    // Deactivate submit button to avoid further clicks
    $('.submit-button').attr("disabled", "disabled");
    
    if (!paymill.validateCardNumber($('.card-number').val())) {
      $(".payment-errors").text("Invalid card number");
      $(".submit-button").removeAttr("disabled");
      return false;
    }

    if (!paymill.validateExpiry(
      $('.card-expiry-month').val(),
      $('.card-expiry-year').val())
    ) {
      $(".payment-errors").text("Invalid expiration date");
      $(".submit-button").removeAttr("disabled");
      return false;
    }

    paymill.createToken({
      number:         $('.card-number').val(),
      exp_month:      $('.card-expiry-month').val(),
      exp_year:       $('.card-expiry-year').val(),
      cvc:            $('.card-cvc').val(),
      cardholder:     $('.card-holdername').val(),
      amount_int:     $('.card-amount-int').val(), // Integer e.g. "4900" fÃ¼r 49,00 EUR
      currency:       $('.card-currency').val()    // ISO 4217 z.B. "EUR"
      }, PaymillResponseHandler);

    return false;
  });
});  
</script>

{{template "footer"}}
{{end}}
